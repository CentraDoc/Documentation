<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Liberty Systems CentraDoc: GCO Part 2 - More details regarding the Generic Root class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="centradoc.png"/></td>
  <td id="projectalign">
   <div id="projectname">Liberty Systems CentraDoc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gcodocs2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">GCO Part 2 - More details regarding the <a class="el" href="class_generic.html" title="ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....">Generic</a> Root class </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_gco_gcodocs2"></a></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Some Terminology</h1>
<p >The definitions here are as relates to GCO - the generic term may have a different meaning.</p>
<p ><b>Class</b> : the unit of object oriented programming classes have behaviour (methods/functions) and state (fields/data) fields are usually protected. (The use of a callback mechanism can provide 'events' as well, a useful ingredient in a component model.) Classes have a 'shared' part, common to all instances, and then each instance has its own state, as well.</p>
<p ><b>Factory</b> : The 'shared' part of a class - the factory produces instances</p>
<p ><b>Instance</b> : an individual object, with separate state</p>
<p ><b>Inherit</b> : Classes may Inherit from a Parent class. All classes have parents except the root class, <a class="el" href="class_generic.html" title="ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....">Generic</a>.</p>
<p ><b>Override</b> : To replace behaviour in the parent</p>
<p ><b>Super</b> : To call the parent's method - requires super casts as well.</p>
<p >for class Xyz: </p><div class="fragment"><div class="line">XyzSuper.Method(XyzAsSuper(self));</div>
</div><!-- fragment --><p> for factory Xyz: </p><div class="fragment"><div class="line">XyzSuperClass.Method(XyzAsSuperClass(factory));</div>
</div><!-- fragment --><p> <b>Binding</b> : A class must be bound before it can be used - binding is automatic by default, but can be switched to manual as needed.</p>
<p ><b>Casts</b> : GCO is C and not C++, so any type conversion must be explicit. Literal C casts are extremely unsafe, so GCO provides type checked functions that do the casting. The checking can be turned off for performance, after testing. There are 2 kinds of casts: Up Casts, and Down Casts.</p>
<p ><b>Upcast</b> : casting up the type tree to a parent. In C++, this isn't a cast at all, use of a child type is checked and accepted by the compiler without direction or comment. Because GCO is in C, upcasts must be explicit. For example, if you had a GrafElm class, and a Rectangle class, you would have to: </p><div class="fragment"><div class="line"><span class="comment">/* RectanglePtr r; */</span></div>
<div class="line">GrafElmPtr gep = RectangleAsGrafElm(r);</div>
</div><!-- fragment --><p> <b>Downcast</b> : casting down the tree is inherently unsafe unless there is some kind of run-time-type-identification available. In C++ this is called 'dynamic casting'. GCO has RTTI built in. Here is the inverse of above: </p><div class="fragment"><div class="line"><span class="comment">/* GrafElmPtr gep; */</span></div>
<div class="line">RectanglePtr r = Rectangle_InstanceCast(GrafElmPtrAsGeneric(gep));</div>
<div class="line"><span class="keywordflow">if</span> (r) {</div>
<div class="line">    <span class="comment">/* it really is a Rectangle */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> GCO also has dynamic casts for the factories.</p>
<p ><b>Constructor</b> : a Factory method that produces an instance</p>
<p ><b>Destructor</b> : an Instance method responsible for destroying an instance</p>
<p ><b>Reference Counting</b> : Every created instance should eventually be destroyed. GCO is without full scale Garbage collection, so ownership of objects must be maintained in some cooperative fashion. GCO allows objects to be reference counted, meaning they may have multiple owners, and an object won't go away until everybody lets go. Multiple ownership can be a problem if an object's state is changed, be careful when sharing objects.</p>
<p ><b>Copy On Write</b> : complex objects may have a high overhead of copying - so a handle class may be used that references a data object. If the user needs to modify the data, the handle checks to see if multiple references exist to the data object, and if so, it then duplicates the data object before modifying it.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Some Class Relationshis</h1>
<ul>
<li>Uses-in-the-interface - a visible use of a class, typically inheritance or method signatures</li>
<li>Uses-in-the-implementation - a not-visible use of a class, not part of the interface</li>
<li>Is A - the child -&gt; parent relationship. From above: "A Rectangle is a GrafElm"</li>
<li>Has A - the "contains" or "owns" relationship - for example, Rectangle might contain Point objects.</li>
<li>Was A - the 'private' child -&gt; parent relationship, when inheritance is used for convenience and not for type modeling.</li>
</ul>
<hr  />
<p ><a class="el" href="class_generic.html" title="ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....">Generic</a> is the root class of the GCO tree. Lidl creates the following for generic:</p>
<ul>
<li>Typedefed Struct Types: <pre class="fragment">  Instance:      Generic             *GenericPtr;
  Class:         GenericClass        *GenericClassPtr;
  VTable:        GenericVTable,      *GenericVTablePtr;
  FactoryVTable: GenericClassVTable, *GenericClassVTablePtr;
</pre></li>
<li>Variables: <pre class="fragment">  GenericClassPtr    gGeneric;
  GenericVTable      gGenericVTable;
  GenericClassVTable gGenericClassVTable;
</pre></li>
<li>Helper Functions: <pre class="fragment">  GenericClassPtr GenericBind();
  GenericClassPtr GenericBind_C(GenericClassPtr);
</pre></li>
<li>Macro Helpers <pre class="fragment">  GenericClassOf(X) - returns the GenericClassPtr of a GenericPtr
  (no casts in this one at the moment)
</pre></li>
<li>Method Macros for all the factory methods, in 2 forms: <pre class="fragment">  Class_Method(Parms)     with implied factory parameter
  Class_Method_C(Parms)   with explicit factory parameter
</pre></li>
<li>Method Macros for all the instance methods, in this form: <pre class="fragment">  Class_Method(Parms)     first parameter is always the instance ptr
</pre> </li>
</ul>
<h1><a class="anchor" id="autotoc_md18"></a>
Here are the Generic Factory methods:</h1>
<div class="fragment"><div class="line"><span class="keywordtype">void</span>      FactoryInit(Factory);</div>
<div class="line"><span class="keywordtype">void</span>      FactoryDone(Factory);</div>
<div class="line">Instance  Construct(Factory c, <span class="keywordtype">void</span> *p, <span class="keywordtype">int</span> size);</div>
<div class="line">Instance  InstanceCast(Factory, <a class="code hl_class" href="class_generic.html">GenericPtr</a>);</div>
<div class="ttc" id="aclass_generic_html"><div class="ttname"><a href="class_generic.html">Generic</a></div><div class="ttdoc">ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....</div><div class="ttdef"><b>Definition:</b> gcobase.h:114</div></div>
</div><!-- fragment --><p> When a class is first used, it has to be "bound". The standalone BINDCLASS function is responsible for initializing the class basics, copying the vtable from the parent, stitching the class into the class tree, etc. It will also call the FactoryInit function, which is a place to hook in if the class needs some general initialization before it can create any instances. If anything bad happens, the FactoryInit has to throw an exception or do something else drastic. FactoryDone is a placeholder to balance out FactoryInit - it's not plugged in, but might be if it's needed.</p>
<p >BINDCLASS is hidden in the type-safe GenericBind, and hidden again inside the Auto-Bind feature. By default, classes Auto-Bind, which means any call to a Factory method will actually call bind to make sure the Factory is initialized. This is a slight performance hit and can be turned off as needed; see matrix.c for an example. GCO_ClassIsBound is a macro that can be used to check the flag directly, to avoid the overhead of the function call to BINDCLASS, and to avoid directly coding the class flag check.</p>
<p >Construct is the <a class="el" href="class_generic.html" title="ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....">Generic</a> Constructor. A pointer and size can be specified for either a 'static' object, or an 'oversized' object, respectively. Passing 0 for both gives the default allocation at the default sizeof(instance).</p>
<p >Most classes will need a more friendly constructor possibly with parameters. The names New or Build are suggested. Not every class needs the static/oversize support of Construct, or may not need to make the support visible to consumers of the class. It is up to the Class Designer to decide if Construct needs to be overridden for guaranteed additional initialization, or if the users should simply always call an alternative constructor. Typically, the alternative constructor will call construct or make to do the actual construction and then do initializations as necessary. Overriding Construct would likely require the use of a Super call.</p>
<p >InstanceCast is a checked dynamic casts. This means, if you have an arbitrary instance, you can determine if it is of a particular subtype. The parameter must be cast to generic. There are also equivalent functions: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="gcoutils_8h.html#ae9665eaa008f6a2044c0c49eae92d105">GCO_ClassIsChildOf</a>(GenericClassPtr child, GenericClassPtr parent);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="gcoutils_8h.html#ac48ce815c3b5cf20f32ed919adee60cd">GCO_InstanceIsKindOf</a>(<a class="code hl_class" href="class_generic.html">GenericPtr</a> instance, GenericClassPtr kind);</div>
<div class="ttc" id="agcoutils_8h_html_ac48ce815c3b5cf20f32ed919adee60cd"><div class="ttname"><a href="gcoutils_8h.html#ac48ce815c3b5cf20f32ed919adee60cd">GCO_InstanceIsKindOf</a></div><div class="ttdeci">int GCO_InstanceIsKindOf(GenericPtr instance, GenericClassPtr kind)</div></div>
<div class="ttc" id="agcoutils_8h_html_ae9665eaa008f6a2044c0c49eae92d105"><div class="ttname"><a href="gcoutils_8h.html#ae9665eaa008f6a2044c0c49eae92d105">GCO_ClassIsChildOf</a></div><div class="ttdeci">int GCO_ClassIsChildOf(GenericClassPtr child, GenericClassPtr parent)</div></div>
</div><!-- fragment --><p> Here are the <a class="el" href="class_generic.html" title="ref Generic, IGeneric, IGenericFactory and the C API starting with Generic_ in gco/gcobase....">Generic</a> Instance Methods: </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Use(Instance);       <span class="comment">/* AddRef */</span></div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Discard(Instance);   <span class="comment">/* Release */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span>          Destruct(Instance);</div>
<div class="line">Instance      Clone(Instance);</div>
</div><!-- fragment --><p> Use and Discard are the Reference counting methods. To keep an object reference alive, call Use. To let go of a reference, call Discard. If you have the only reference, Discard will call Destruct.</p>
<p >Destruct is the 'final' destructor for a class, called when all outstanding references are released. If a class has any objects that need to be freed, Destruct must be overridden, and don't forget to call Super.Destruct to actually do the destroy.</p>
<p >GCO avoids the common verbs Free, Release, Destroy, Dispose, etc. COM uses AddRef and Release.</p>
<p >Destruct reflects the Construct verb.</p>
<p >Clone is the standard 'copy' method. If you override Destruct, you will need to override clone. These are 2 of 'the big 3' in C++ - GCO has no equivalent of an assignment operator. An assignment of a GCO pointer is simply a borrowed reference, where in C++, an assignment of a class (or handle) might do any number of interesting things, including, for example, automatic reference counting.</p>
<p >Another aspect of COM is QueryInterface. GCO has a similar feature called Facets. </p><pre class="fragment">    SomeABCPtr abc;
    SomeXYZPtr xyz;

    xyz = Facet_Query(SomeABCAsGeneric(abc), SomeXYZAsGenericClass(gXYZ));
</pre><p> ...</p>
<p >GCO has been modified to be compatible with COM. This changes the instance pointer to point to the first vtable entry instead of to the class pointer that the vtable starts with, which makes the class lookup slightly trickier, and loses the Debug convenience of being able to tell exactly what class an instance is without having to look at the vtable entries.</p>
<p >There are now two separate C++ compatibility layers; the HClass layer, which is a simple layer wrapping the GCO instance handles, and the IClass layer, which writes out two COM compatible struct declarations for each class definition, one for the instance and one for the factory.</p>
<p >Using GCO to produce COM interfaces makes interfacing with C++ more natural. Here is some example code that uses a couple of <a class="el" href="class_f_fs.html" title="ref FFs, IFFs, IFFsFactory and the C API starting with FFs_ in ffs/ffs.h">FFs</a> interfaces: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ffsstd_8h.html">ffsstd.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="pdfcreate1_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>() {</div>
<div class="line">    <a class="code hl_struct" href="struct_i_f_fs_std_factory.html">IFFsStdFactory</a> *ffsStdFactory = <a class="code hl_define" href="ffsstd_8h.html#a244d0130ec12c7fdfc34aa435057f67c">GetIFFsStdFactory</a>();</div>
<div class="line">    <a class="code hl_struct" href="struct_i_f_fs.html">IFFs</a> *out = ffsStdFactory-&gt;<a class="code hl_function" href="struct_i_f_fs_std_factory.html#ad1f33056b7a04109902977943ec9acc7">NewOut</a>();</div>
<div class="line">    out-&gt;<a class="code hl_function" href="struct_i_f_fs.html#afa6010e15cdb550d4f5bb82d632ffccd">WriteCStr</a>(<span class="stringliteral">&quot;Hello world\n&quot;</span>);</div>
<div class="line">    out-&gt;Release();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="struct_i_f_fs_o_s_factory.html">IFFsOSFactory</a> *ffsOSFactory = <a class="code hl_define" href="ffs_8h.html#a46480521dd826f80e6ce31b92376cd87">GetIFFsOSFactory</a>();</div>
<div class="line">    out = ffsOSFactory-&gt;<a class="code hl_function" href="struct_i_f_fs_factory.html#a5a552004af49c7c1c7a1031cefbfa11e">New</a>(<span class="stringliteral">&quot;TESTFILE.TXT&quot;</span>, <a class="code hl_enumvalue" href="ffs_8h.html#a499856798bc7e4e94ee58de03d3c3e0ba4e6828135c5abfeed0def85a1ab218b0">FFS_WRITE</a>);</div>
<div class="line">    out-&gt;<a class="code hl_function" href="struct_i_f_fs.html#afa6010e15cdb550d4f5bb82d632ffccd">WriteCStr</a>(<span class="stringliteral">&quot;Hello world\n&quot;</span>);</div>
<div class="line">    out-&gt;Release();</div>
<div class="line">}</div>
<div class="ttc" id="affs_8h_html_a46480521dd826f80e6ce31b92376cd87"><div class="ttname"><a href="ffs_8h.html#a46480521dd826f80e6ce31b92376cd87">GetIFFsOSFactory</a></div><div class="ttdeci">#define GetIFFsOSFactory()</div><div class="ttdef"><b>Definition:</b> ffs.h:597</div></div>
<div class="ttc" id="affs_8h_html_a499856798bc7e4e94ee58de03d3c3e0ba4e6828135c5abfeed0def85a1ab218b0"><div class="ttname"><a href="ffs_8h.html#a499856798bc7e4e94ee58de03d3c3e0ba4e6828135c5abfeed0def85a1ab218b0">FFS_WRITE</a></div><div class="ttdeci">@ FFS_WRITE</div><div class="ttdef"><b>Definition:</b> ffs.h:125</div></div>
<div class="ttc" id="affsstd_8h_html"><div class="ttname"><a href="ffsstd_8h.html">ffsstd.h</a></div></div>
<div class="ttc" id="affsstd_8h_html_a244d0130ec12c7fdfc34aa435057f67c"><div class="ttname"><a href="ffsstd_8h.html#a244d0130ec12c7fdfc34aa435057f67c">GetIFFsStdFactory</a></div><div class="ttdeci">#define GetIFFsStdFactory()</div><div class="ttdef"><b>Definition:</b> ffsstd.h:95</div></div>
<div class="ttc" id="apdfcreate1_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="pdfcreate1_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> pdfcreate1.c:74</div></div>
<div class="ttc" id="astruct_i_f_fs_factory_html_a5a552004af49c7c1c7a1031cefbfa11e"><div class="ttname"><a href="struct_i_f_fs_factory.html#a5a552004af49c7c1c7a1031cefbfa11e">IFFsFactory::New</a></div><div class="ttdeci">virtual IFFs *GCO_METHOD New(char *buf, size_t bufsz)=0</div></div>
<div class="ttc" id="astruct_i_f_fs_html"><div class="ttname"><a href="struct_i_f_fs.html">IFFs</a></div><div class="ttdef"><b>Definition:</b> ffs.h:347</div></div>
<div class="ttc" id="astruct_i_f_fs_html_afa6010e15cdb550d4f5bb82d632ffccd"><div class="ttname"><a href="struct_i_f_fs.html#afa6010e15cdb550d4f5bb82d632ffccd">IFFs::WriteCStr</a></div><div class="ttdeci">virtual size_t GCO_METHOD WriteCStr(const char *s)=0</div></div>
<div class="ttc" id="astruct_i_f_fs_o_s_factory_html"><div class="ttname"><a href="struct_i_f_fs_o_s_factory.html">IFFsOSFactory</a></div><div class="ttdef"><b>Definition:</b> ffs.h:582</div></div>
<div class="ttc" id="astruct_i_f_fs_std_factory_html"><div class="ttname"><a href="struct_i_f_fs_std_factory.html">IFFsStdFactory</a></div><div class="ttdef"><b>Definition:</b> ffsstd.h:83</div></div>
<div class="ttc" id="astruct_i_f_fs_std_factory_html_ad1f33056b7a04109902977943ec9acc7"><div class="ttname"><a href="struct_i_f_fs_std_factory.html#ad1f33056b7a04109902977943ec9acc7">IFFsStdFactory::NewOut</a></div><div class="ttdeci">virtual IFFs *GCO_METHOD NewOut()=0</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon May 8 2023 15:18:03 for Liberty Systems CentraDoc by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
